Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@urql/core"),t=require("react"),r=require("wonka");const n=e.createClient({url:"/graphql"}),o=t.createContext(n),s=o.Provider,u=o.Consumer;o.displayName="UrqlContext";const c=()=>t.useContext(o),i={fetching:!1,stale:!1,error:void 0,data:void 0,extensions:void 0,operation:void 0},a=(e,t)=>{const r={...e,...t,data:void 0!==t.data||t.error?t.data:e.data,fetching:!!t.fetching,stale:!!t.stale};return((e,t)=>{if("object"!=typeof e||"object"!=typeof t)return e!==t;for(const r in e)if(!(r in t))return!0;for(const r in t)if(e[r]!==t[r])return!0;return!1})(e,r)?r:e},l=(e,t)=>{for(let r=0,n=t.length;r<n;r++)if(e[r]!==t[r])return!0;return!1};function f(n){const o=t.useRef(!0),s=c(),[u,a]=t.useState(i),l=t.useCallback(((t,u)=>(a({...i,fetching:!0}),r.toPromise(s.executeMutation(e.createRequest(n,t),u||{})).then((e=>(o.current&&a({fetching:!1,stale:!!e.stale,data:e.data,error:e.error,extensions:e.extensions,operation:e.operation}),e))))),[s,n,a]);return t.useEffect((()=>(o.current=!0,()=>{o.current=!1})),[]),[u,l]}function d(r,n){const o=t.useRef(void 0);return t.useMemo((()=>{const t=e.createRequest(r,n);return void 0!==o.current&&o.current.key===t.key?o.current:(o.current=t,t)}),[r,n])}function p(e){const n=c(),o=(e=>{if(!e._react){const t=new Set,n=new Map;e.operations$&&r.subscribe((e=>{"teardown"===e.kind&&t.has(e.key)&&(t.delete(e.key),n.delete(e.key))}))(e.operations$),e._react={get:e=>n.get(e),set(e,r){t.delete(e),n.set(e,r)},dispose(e){t.add(e)}}}return e._react})(n),s=((e,t)=>e.suspense&&(!t||!1!==t.suspense))(n,e.context),u=d(e.query,e.variables),f=t.useMemo((()=>{if(e.pause)return null;const t=n.executeQuery(u,{requestPolicy:e.requestPolicy,...e.context});return s?r.onPush((e=>{o.set(u.key,e)}))(t):t}),[o,n,u,s,e.pause,e.requestPolicy,e.context]),p=t.useCallback(((e,t)=>{if(!e)return{fetching:!1};let n=o.get(u.key);if(n){if(t&&null!=n&&"then"in n)throw n}else{let s;const c=r.subscribe((e=>{n=e,s&&s(n)}))(r.takeWhile((()=>t&&!s||!n))(e));if(null==n&&t){const e=new Promise((e=>{s=e}));throw o.set(u.key,e),e}c.unsubscribe()}return n||{fetching:!0}}),[o,u]),x=[n,u,e.requestPolicy,e.context,e.pause],[y,b]=t.useState((()=>[f,a(i,p(f,s)),x]));let h=y[1];f!==y[0]&&l(y[2],x)&&b([f,h=a(y[1],p(f,s)),x]),t.useEffect((()=>{const e=y[0],t=y[2][1];let n=!1;const s=e=>{n=!0,b((t=>{const r=a(t[1],e);return t[1]!==r?[t[0],r,t[2]]:t}))};if(e){const u=r.subscribe(s)(r.onEnd((()=>{s({fetching:!1})}))(e));return n||s({fetching:!0}),()=>{o.dispose(t.key),u.unsubscribe()}}s({fetching:!1})}),[o,y[0],y[2][1]]);const g=t.useCallback((t=>{const c={requestPolicy:e.requestPolicy,...e.context,...t};b((e=>[s?r.onPush((e=>{o.set(u.key,e)}))(n.executeQuery(u,c)):n.executeQuery(u,c),e[1],x]))}),[n,o,u,s,p,e.requestPolicy,e.context]);return[h,g]}function x(e,n){const o=c(),s=d(e.query,e.variables),u=t.useRef(n);u.current=n;const f=t.useMemo((()=>e.pause?null:o.executeSubscription(s,e.context)),[o,s,e.pause,e.context]),p=[o,s,e.context,e.pause],[x,y]=t.useState((()=>[f,{...i,fetching:!!f},p]));let b=x[1];f!==x[0]&&l(x[2],p)&&y([f,b=a(x[1],{fetching:!!f}),p]),t.useEffect((()=>{const e=e=>{y((t=>{const r=a(t[1],e);return t[1]===r?t:(u.current&&t[1].data!==r.data&&(r.data=u.current(t[1].data,r.data)),[t[0],r,t[2]])}))};if(x[0])return r.subscribe(e)(r.onEnd((()=>{e({fetching:!1})}))(x[0])).unsubscribe;e({fetching:!1})}),[x[0]]);const h=t.useCallback((t=>{const r=o.executeSubscription(s,{...e.context,...t});y((e=>[r,e[1],p]))}),[o,e.context,s]);return[b,h]}exports.Consumer=u,exports.Context=o,exports.Mutation=function(e){const t=f(e.query);return e.children({...t[0],executeMutation:t[1]})},exports.Provider=s,exports.Query=function(e){const t=p(e);return e.children({...t[0],executeQuery:t[1]})},exports.Subscription=function(e){const t=x(e,e.handler);return e.children({...t[0],executeSubscription:t[1]})},exports.useClient=c,exports.useMutation=f,exports.useQuery=p,exports.useSubscription=x,Object.keys(e).forEach((function(t){"default"===t||exports.hasOwnProperty(t)||Object.defineProperty(exports,t,{enumerable:!0,get:function(){return e[t]}})}));
//# sourceMappingURL=urql.min.js.map
