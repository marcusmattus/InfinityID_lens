import{createClient as e,createRequest as t}from"@urql/core";export*from"@urql/core";import{createContext as n,useContext as r,useRef as o,useState as c,useCallback as u,useEffect as s,useMemo as i}from"react";import{toPromise as a,subscribe as l,onPush as f,takeWhile as d,onEnd as p}from"wonka";const y=n(e({url:"/graphql"})),x=y.Provider,h=y.Consumer;y.displayName="UrqlContext";const g=()=>r(y),q={fetching:!1,stale:!1,error:void 0,data:void 0,extensions:void 0,operation:void 0},b=(e,t)=>{const n={...e,...t,data:void 0!==t.data||t.error?t.data:e.data,fetching:!!t.fetching,stale:!!t.stale};return((e,t)=>{if("object"!=typeof e||"object"!=typeof t)return e!==t;for(const n in e)if(!(n in t))return!0;for(const n in t)if(e[n]!==t[n])return!0;return!1})(e,n)?n:e},k=(e,t)=>{for(let n=0,r=t.length;n<r;n++)if(e[n]!==t[n])return!0;return!1};function m(e){const n=o(!0),r=g(),[i,l]=c(q),f=u(((o,c)=>(l({...q,fetching:!0}),a(r.executeMutation(t(e,o),c||{})).then((e=>(n.current&&l({fetching:!1,stale:!!e.stale,data:e.data,error:e.error,extensions:e.extensions,operation:e.operation}),e))))),[r,e,l]);return s((()=>(n.current=!0,()=>{n.current=!1})),[]),[i,f]}function v(e,n){const r=o(void 0);return i((()=>{const o=t(e,n);return void 0!==r.current&&r.current.key===o.key?r.current:(r.current=o,o)}),[e,n])}function P(e){const t=g(),n=(e=>{if(!e._react){const t=new Set,n=new Map;e.operations$&&l((e=>{"teardown"===e.kind&&t.has(e.key)&&(t.delete(e.key),n.delete(e.key))}))(e.operations$),e._react={get:e=>n.get(e),set(e,r){t.delete(e),n.set(e,r)},dispose(e){t.add(e)}}}return e._react})(t),r=((e,t)=>e.suspense&&(!t||!1!==t.suspense))(t,e.context),o=v(e.query,e.variables),a=i((()=>{if(e.pause)return null;const c=t.executeQuery(o,{requestPolicy:e.requestPolicy,...e.context});return r?f((e=>{n.set(o.key,e)}))(c):c}),[n,t,o,r,e.pause,e.requestPolicy,e.context]),y=u(((e,t)=>{if(!e)return{fetching:!1};let r=n.get(o.key);if(r){if(t&&null!=r&&"then"in r)throw r}else{let c;const u=l((e=>{r=e,c&&c(r)}))(d((()=>t&&!c||!r))(e));if(null==r&&t){const e=new Promise((e=>{c=e}));throw n.set(o.key,e),e}u.unsubscribe()}return r||{fetching:!0}}),[n,o]),x=[t,o,e.requestPolicy,e.context,e.pause],[h,m]=c((()=>[a,b(q,y(a,r)),x]));let P=h[1];a!==h[0]&&k(h[2],x)&&m([a,P=b(h[1],y(a,r)),x]),s((()=>{const e=h[0],t=h[2][1];let r=!1;const o=e=>{r=!0,m((t=>{const n=b(t[1],e);return t[1]!==n?[t[0],n,t[2]]:t}))};if(e){const c=l(o)(p((()=>{o({fetching:!1})}))(e));return r||o({fetching:!0}),()=>{n.dispose(t.key),c.unsubscribe()}}o({fetching:!1})}),[n,h[0],h[2][1]]);const w=u((c=>{const u={requestPolicy:e.requestPolicy,...e.context,...c};m((e=>[r?f((e=>{n.set(o.key,e)}))(t.executeQuery(o,u)):t.executeQuery(o,u),e[1],x]))}),[t,n,o,r,y,e.requestPolicy,e.context]);return[P,w]}function w(e,t){const n=g(),r=v(e.query,e.variables),a=o(t);a.current=t;const f=i((()=>e.pause?null:n.executeSubscription(r,e.context)),[n,r,e.pause,e.context]),d=[n,r,e.context,e.pause],[y,x]=c((()=>[f,{...q,fetching:!!f},d]));let h=y[1];f!==y[0]&&k(y[2],d)&&x([f,h=b(y[1],{fetching:!!f}),d]),s((()=>{const e=e=>{x((t=>{const n=b(t[1],e);return t[1]===n?t:(a.current&&t[1].data!==n.data&&(n.data=a.current(t[1].data,n.data)),[t[0],n,t[2]])}))};if(y[0])return l(e)(p((()=>{e({fetching:!1})}))(y[0])).unsubscribe;e({fetching:!1})}),[y[0]]);const m=u((t=>{const o=n.executeSubscription(r,{...e.context,...t});x((e=>[o,e[1],d]))}),[n,e.context,r]);return[h,m]}function Q(e){const t=m(e.query);return e.children({...t[0],executeMutation:t[1]})}function S(e){const t=P(e);return e.children({...t[0],executeQuery:t[1]})}function M(e){const t=w(e,e.handler);return e.children({...t[0],executeSubscription:t[1]})}export{h as Consumer,y as Context,Q as Mutation,x as Provider,S as Query,M as Subscription,g as useClient,m as useMutation,P as useQuery,w as useSubscription};
//# sourceMappingURL=urql.min.es.js.map
